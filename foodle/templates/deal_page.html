{% extends 'base.html' %}
{% load staticfiles %}

{% block head %}
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link rel="stylesheet" href="/static/css/img.css">


{% endblock %}

{% block content %}
{% for deal in deals %}

<!-- greg's deal_page details (start) -->
<div id="map"></div>
<br />
<br />
<br />
<div class="container">

    <div class="card" style="width: 21.5em;margin:0 auto;">

        {% if deal.picture %}
        <img class="card-img-top" src="{{ deal.picture.url }}" alt="Card image cap"> 
        {% endif %}

        <div class="card-body">
          <h5 class="card-title">Deal</h5>

          <strong class="card-text">{{deal.info}}</strong>
          <p class="card-text">{{deal.address}}</p>
          <div class="row">
          <p id="like_count{{forloop.counter0}}" class="col-md-6">likes: {{ deal.likes }}</p>
          </div>
          <ul class="nav center">
            {% if user.is_authenticated %}
            <button id="btn{{forloop.counter0}}" class="btn btn-primary" type="button" onclick="like('{{deal.id}}', '#like_count{{forloop.counter0}}', '#btn{{forloop.counter0}}', 'like')"> like </button>
            {% endif %}
            <a class="nav-link" href="https://github.com/glasgowm148/foodle_dev"><i class="far fa-bookmark"></i></a>
            <a class="nav-link" href="https://github.com/glasgowm148/foodle_dev"><i class="far fa-flag"></i></a>
            <a class="nav-link" href="https://github.com/glasgowm148/foodle_dev"><i class="fas fa-share-alt"></i></a>
            {% if user.is_authenticated %}
            <button id="btn2{{forloop.counter0}}" class="btn btn-primary" type="button" onclick="like('{{deal.id}}', '#like_count{{forloop.counter0}}', '#btn2{{forloop.counter0}}', 'dislike')"> dislike </button>
            {% endif %}
          </ul>
        </div>
      </div>
    </div>

  </div> 
</div>
{% endfor %}

<script>
function like(dealid, id, id2, pref) {
  $.get('/like/', {deal_id: dealid }, function(data){ 

    $(id).html('likes: '+data); 
    if($(id2).value=="like") {
    $(id2).html('remove '+pref);
    }
    else {
      $(id2).html(pref);
    }
  });
}
</script>

<script>
    function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 15,
          center: {lat: 55.872158, lng: -4.287869}
        });
        var geocoder = new google.maps.Geocoder();
          geocodeAddress(geocoder, map);
      }

      function geocodeAddress(geocoder, resultsMap) {
        var address = document.getElementById('address').value;
        geocoder.geocode({'address': address}, function(results, status) {
          if (status === 'OK') {
            resultsMap.setCenter(results[0].geometry.location);
            var marker = new google.maps.Marker({
              map: resultsMap,
              position: results[0].geometry.location
            });
          } else {
            alert('Geocode was not successful for the following reason: ' + status);
          }
        });
      }
   </script>


<script>

      if (navigator.geolocation) { 
   navigator.geolocation.getCurrentPosition(function (position) {        
     var lat = position.coords.latitude;                   
     var lng = position.coords.longitude;                
     var curLoc = new google.maps.LatLng(lat, lng); 
     var directionsService = new google.maps.DirectionsService();
     var directionsDisplay = new google.maps.DirectionsRenderer();
	 var whereTo = document.getElementById('address').value;   
     var mapOptions = { 
       zoom: 15,  
       center: curLoc, 
       mapTypeControl: true, 
     }; 
     map = new google.maps.Map(document.getElementById("map"), mapOptions);
     directionsDisplay.setMap(map);
	 var request = { 
       origin: curLoc,
       destination: whereTo,   
       travelMode: google.maps.DirectionsTravelMode.WALKING
     }; 
     directionsService.route(request, function (response, status) { 
       if (status == google.maps.DirectionsStatus.OK) { 
         directionsDisplay.setDirections(response);
       } 
     }); 
   });
 } 

    </script>

<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDye3jFXoyb4arMeb6ea6w1c_gTyS8RE5Y&callback=initMap">
</script>
<!-- greg deal_page details (end)	-->
{% endblock %}
